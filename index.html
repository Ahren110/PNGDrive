<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>PNGDrive.js</title>
	<meta property="og:title" content="PNGDrive.js"/>
	<meta property="og:description" content="PNGDrive.js is a JavaScript library to pack multiple files into a PNG."/>
	<meta property="og:type" content="movie"/>
	<meta property="og:url" content="http://pngdrive.devinhaus.com/"/>
	<meta property="og:image" content="http://pngdrive.devinhaus.com/pngdrive.png"/>
	<meta property="fb:admins" content="700876948"/>
	<link rel="stylesheet" href="css/pngdrive.css" />
</head>
<body>

<h1>PNGDrive.js</h1>
<p>PNGDrive.js is a JavaScript library to pack multiple files into a PNG. <a href="https://github.com/MadeInHaus/PNGDrive">Fork it on GitHub</a>.</p>

<div id="file-drop-area">Drop files here</div>
<div id="file-list"></div>
<div id="file-info"></div>
<div id="file-error"></div>
<div id="image"></div>
<div id="decode-result"><a id="decode-result-a" href="#">decode</a></div>

<script src="lib/pngdrive-min.js"></script>
<script>

	(function() {

		var fileDropArea = document.getElementById("file-drop-area");
		var fileList = document.getElementById("file-list");
		var fileInfo = document.getElementById("file-info");
		var fileError = document.getElementById("file-error");
		var decodeResult = document.getElementById("decode-result");

		decodeResult.style.display = "none";
		document.getElementById("decode-result-a").addEventListener('click', decodeResultHandler);

		var files = [];
		var pngdrive = new PNGDrive();

		if (window.File && window.FileReader && window.FileList && window.Blob && window.atob && window.JSON) {
			fileDropArea.addEventListener('dragover', handleDragOver, false);
			fileDropArea.addEventListener('dragout', handleDragOut, false);
			fileDropArea.addEventListener('drop', handleFileSelect, false);
		} else {
			fileDropArea.style.display = fileList.style.display = "none";
			fileError.style.display = "block";
			var report = "<p>This demo requires some features that are not supported by this browser. Sadface.</p>";
			var li = "";
			li += "<li class=\"" + (window.File ? "win" : "fail") +  "\">File: " + (window.File ? "supported" : "not supported") + "</li>";
			li += "<li class=\"" + (window.FileReader ? "win" : "fail") +  "\">FileReader: " + (window.FileReader ? "supported" : "not supported") + "</li>";
			li += "<li class=\"" + (window.FileList ? "win" : "fail") +  "\">FileList: " + (window.FileList ? "supported" : "not supported") + "</li>";
			li += "<li class=\"" + (window.Blob ? "win" : "fail") +  "\">Blob: " + (window.Blob ? "supported" : "not supported") + "</li>";
			li += "<li class=\"" + (window.JSON ? "win" : "fail") +  "\">JSON: " + (window.JSON ? "supported" : "not supported") + "</li>";
			li += "<li class=\"" + (window.atob ? "win" : "fail") +  "\">atob(): " + (window.atob ? "supported" : "not supported") + "</li>";
			fileError.innerHTML = report + "<ul>" + li + "</ul>Try Chrome or Firefox.";
		}

		function handleFileSelect(event) {
			event.stopPropagation();
			event.preventDefault();
			var fl = event.dataTransfer.files;
			for (var i = 0, f; f = fl[i]; i++) {
				pngdrive.addFile(f);
				files.push(f);
			}
			update();
			fileDropArea.style.backgroundColor = "transparent";
		}

		function handleDragOver(event) {
			event.stopPropagation();
			event.preventDefault();
			event.dataTransfer.dropEffect = 'copy';
			fileDropArea.style.backgroundColor = "#eee";
		}

		function handleDragOut(event) {
			event.stopPropagation();
			event.preventDefault();
			fileDropArea.style.backgroundColor = "transparent";
		}

		function update() {
			pngdrive.encode(function() {
				var imgContainer = document.getElementById("image");
				var img = this.getImgElement();
				img.id = "result-image";
				imgContainer.innerHTML = "";
				imgContainer.appendChild(img);
				var ul = "";
				var contentSize = 0;
				var numFiles = this.getFileCount();
				for(var i = 0; i < numFiles; i++) {
					var f = this.getFileAt(i);
					ul += "<li data-index=\"" + i + "\"><strong>" + encodeURIComponent(f.name) +  "</strong>, " + f.content.byteLength + " bytes (" + (f.type || 'n/a') + ")</li>";
					contentSize += f.content.byteLength;
				}
				fileList.innerHTML = numFiles + " Files:<ul>" + ul + "</ul>";
				var px = this.getImgSize();
				fileInfo.innerHTML = "Bitmap: " + px + "x" + px + " px<br>" +
					"Content Size: " + contentSize + " bytes<br>" +
					"Uncompressed Size: " + this.getUncompressedSize() + " bytes<br>" +
					"Compressed Size: " + this.getCompressedSize() + " bytes<br>" +
					"Ratio: " + this.getCompressedSize() / this.getUncompressedSize() + "<br>";
				decodeResult.style.display = "block";
			});
		}

		function decodeResultHandler(event) {
			pngdrive.decode(document.getElementById("result-image"));
			var numFiles = pngdrive.getFileCount();
			console.log("Files: " + numFiles + ", ",
				"Uncompressed Size: " + pngdrive.getUncompressedSize() + " bytes, " ,
				"Compressed Size: " + pngdrive.getCompressedSize() + " bytes");
			for(var i = 0; i < numFiles; i++) {
				var file = pngdrive.getFileAt(i);
				console.log("  " + i + ": " + file.name + ", " + file.content.byteLength);
			}
		}

	})();

</script>
</body>
</html>
